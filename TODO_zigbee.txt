Frostbee - Zigbee TODO
=======================

Status: Dev działa, produkcja wymaga dopracowania


ZMIANY DO COFNIĘCIA DLA PRODUKCJI
---------------------------------

1. [main.c:29] Interwał odczytu sensora
   Dev:  SENSOR_READ_INTERVAL_S = 10
   Prod: SENSOR_READ_INTERVAL_S = 600

2. [main.c:37] Kasowanie NVRAM przy starcie
   Dev:  ERASE_PERSISTENT_CONFIG = ZB_TRUE  (kasuj, rejoin przy każdym bocie)
   Prod: ERASE_PERSISTENT_CONFIG = ZB_FALSE (zachowaj dane sieci)

3. [main.c] Raportowanie ZCL
   NAPRAWIONE: ZB_FALSE — ZBOSS reporting engine respektuje Configure Reporting
   od koordynatora (progi, interwały). Nie trzeba zmieniać dla produkcji.

4. [pm_static.yml] Partycje flash
   Dev:  pm_static.yml (bez ZBOSS NVRAM - zero zapisów do flash)
   Prod: pm_static_release.yml (z ZBOSS NVRAM dla persystencji)

5. [prj.conf] RAM power down
   Dev:  CONFIG_RAM_POWER_DOWN_LIBRARY wyłączone (bezpieczne dla bootloadera)
   Prod: prj_release.conf z CONFIG_RAM_POWER_DOWN_LIBRARY=y

6. [prj.conf] Logi/Serial
   Dev:  CONFIG_LOG=y, CONFIG_SERIAL=y (debug)
   Prod: prj_release.conf z CONFIG_LOG=n, CONFIG_SERIAL=n (oszczędność baterii)


BRAKUJĄCE FUNKCJE
-----------------

[x] Bateria - atrybut batteryPercentageRemaining
    ZROBIONE: Atrybut 0x0021 jest zadeklarowany w custom power_config_attr_list
    z flagą ZB_ZCL_ATTR_ACCESS_REPORTING. Wartość hardcoded 82% (TODO: odczyt ADC).

[ ] Bateria - odczyt rzeczywistego napięcia z ADC
    - Obecnie battery_percentage jest hardcoded na 82%
    - Trzeba: odczytać napięcie baterii przez ADC, przeliczyć na procenty


JAK BUDOWAĆ
-----------

Development (domyślne):
  west build -b nrf52840dongle/nrf52840 app

Produkcja (gdy gotowe):
  west build -b nrf52840dongle/nrf52840 app -- \
    -DOVERLAY_CONFIG=prj_release.conf \
    -DPM_STATIC_YML_FILE=pm_static_release.yml


RAPORTOWANIE ZCL - NAPRAWIONE
-----------------------------

Status: ZROBIONE. Używamy ZB_FALSE — ZBOSS reporting engine sam zarządza
        raportami na podstawie Configure Reporting od koordynatora (Z2M).

Jak to działa:
  1. Atrybuty temp/humidity/battery mają flagę ZB_ZCL_ATTR_ACCESS_REPORTING
     - temp_measurement: ustawiona przez makro ZBOSS (ZB_ZCL_DECLARE_TEMP_MEASUREMENT_ATTRIB_LIST)
     - rel_humidity: ustawiona przez makro ZBOSS (ZB_ZCL_DECLARE_REL_HUMIDITY_MEASUREMENT_ATTRIB_LIST)
     - battery_percentage: ustawiona ręcznie w custom power_config_attr_list
  2. Z2M przy parowaniu wysyła "Configure Reporting" z domyślnymi progami:
     - Temperatura: min 10s, max 3600s, zmiana 1.00°C
     - Wilgotność: min 10s, max 3600s, zmiana 1.00%
     - Bateria: min 3600s, max 62000s, każda zmiana
  3. ZB_ZCL_SET_ATTRIBUTE(..., ZB_FALSE) tylko zapisuje wartość
  4. ZBOSS reporting engine porównuje i wysyła raport gdy próg przekroczony

Zrobione:
  [x] Sprawdzić czy atrybuty temp/humidity mają ACCESS_REPORTING — TAK
  [x] Zmienić ZB_TRUE na ZB_FALSE w ZB_ZCL_SET_ATTRIBUTE
  [ ] Sprawdzić logi Z2M czy Configure Reporting przechodzi bez błędów
  [ ] Zweryfikować że raporty idą tylko gdy wartość zmieni się o próg


NOTATKI
-------

- Bootloader UF2 jest chroniony w regionie 0xd8000-0x100000 (160 KB reserved)
- Kanał Zigbee: multi-channel scan (CONFIG_ZIGBEE_CHANNEL_SELECTION_MODE_MULTI=y)
- Device ID: ZB_HA_TEMPERATURE_SENSOR_DEVICE_ID
- Endpoint: 1
- Manufacturer: "Frostbee", Model: "FBE_TH_1"
